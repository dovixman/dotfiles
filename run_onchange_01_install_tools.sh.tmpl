#!/bin/bash

# Verify mise is installed
if ! command -v mise &>/dev/null; then
  echo "âš ï¸ mise no estÃ¡ disponible en el PATH. Verifica que estÃ© instalado correctamente."
  exit 1
fi

# Configure mise
echo "ğŸ”§ Configurando mise..."
mise use -g usage
mise completion fish > ~/.config/fish/completions/mise.fish

# Install programming languages
echo "ğŸ“¦ Instalando lenguajes con mise..."
mise use --global go@latest
mise use --global python@latest
mise use --global node@latest
mise use --global java@latest

# Install togo Tasks
echo "ğŸ”§ Configurando tasks (togo)..."
go install github.com/prime-run/togo@latest

# Install Claude Code CLI
echo "ğŸ”§ Configurando Claude Code..."
if ! command -v claude &>/dev/null; then
  echo "ğŸ“¦ Instalando Claude Code CLI..."
  
  # Check if npm is available
  if ! command -v npm &>/dev/null; then
    echo "âš ï¸ npm no estÃ¡ disponible. AsegÃºrate de que Node.js estÃ© instalado."
    exit 1
  fi
  
  # Install globally via npm
  npm install -g @anthropic-ai/claude-code
  
  if command -v claude &>/dev/null; then
    echo "âœ… Claude Code CLI instalado correctamente"
  else
    echo "âŒ Error al instalar Claude Code CLI"
    exit 1
  fi
else
  echo "âœ… Claude Code CLI ya instalado"
fi

# Install Sketchybar deps
echo "ğŸ”¨Instalando fuentes sketchybar-app-front..."
curl -L https://github.com/kvndrsslr/sketchybar-app-font/releases/download/v1.0.23/sketchybar-app-font.ttf -o $HOME/Library/Fonts/sketchybar-app-font.ttf

echo "ğŸ”¨Instalando SbarLua..."
git clone https://github.com/FelixKratz/SbarLua.git /tmp/SbarLua && cd /tmp/SbarLua/ && make install && rm -rf /tmp/SbarLua/

echo "ğŸ”¨Build deps..."
cd $HOME/.config/sketchybar/helpers && make all

echo "âœ… Herramientas de entorno configuradas"
